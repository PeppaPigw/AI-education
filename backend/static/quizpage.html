<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>åœ¨çº¿æµ‹éªŒ</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #fafbfc;
        color: #333;
      }

      .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 24px 40px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        z-index: 100;
      }

      .progress-wrapper {
        max-width: 600px;
        margin: 0 auto;
      }

      .progress-text {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .progress-label {
        color: #7a6ad8;
        font-weight: 600;
        font-size: 1.1em;
      }

      .progress-count {
        color: #64748b;
        font-size: 0.95em;
      }

      .progress-bar {
        background: #f1f0f9;
        height: 3px;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #7a6ad8, #9b8ce0);
        width: 0%;
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 10px;
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 120px 40px 60px;
      }

      .json-upload {
        background: white;
        border-radius: 32px;
        padding: 60px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        text-align: center;
        border: 1px solid #f0f0f5;
      }

      .json-upload h2 {
        font-size: 2.5em;
        color: #1e293b;
        margin-bottom: 30px;
      }

      .question-slide {
        background: white;
        border-radius: 32px;
        padding: 80px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid #f0f0f5;
      }

      .question-slide.active {
        opacity: 1;
        transform: translateY(0);
      }

      .question-slide.exit {
        opacity: 0;
        transform: translateY(-30px);
      }

      .question-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 40px;
      }

      .question-number {
        background: linear-gradient(135deg, #7a6ad8, #9b8ce0);
        color: white;
        padding: 12px 28px;
        border-radius: 24px;
        font-weight: 600;
        font-size: 1em;
        box-shadow: 0 4px 12px rgba(122, 106, 216, 0.25);
      }

      .question-type {
        color: #94a3b8;
        font-size: 0.95em;
        font-weight: 500;
      }

      .question-text {
        font-size: 2em;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 50px;
        line-height: 1.5;
      }

      .options {
        display: grid;
        gap: 20px;
        margin-bottom: 40px;
      }

      .option {
        background: #fafbfc;
        border: 2px solid #f0f0f5;
        border-radius: 20px;
        padding: 28px 32px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 1.2em;
        position: relative;
        color: #334155;
      }

      .option:hover:not(.disabled) {
        border-color: #7a6ad8;
        background: #f8f7ff;
        transform: translateX(8px);
        box-shadow: 0 4px 16px rgba(122, 106, 216, 0.15);
      }

      .option.selected {
        background: #f8f7ff;
        border-color: #7a6ad8;
      }

      .option.correct {
        background: #f0fdf4;
        border-color: #4ade80;
        animation: correctPulse 0.6s ease;
      }

      .option.incorrect {
        background: #fef2f2;
        border-color: #f87171;
        animation: incorrectShake 0.6s ease;
      }

      .option.disabled {
        cursor: not-allowed;
      }

      @keyframes correctPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      @keyframes incorrectShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-8px);
        }
        75% {
          transform: translateX(8px);
        }
      }

      .option-icon {
        position: absolute;
        right: 32px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.5em;
        font-weight: bold;
      }

      .option.correct .option-icon {
        color: #4ade80;
      }

      .option.incorrect .option-icon {
        color: #f87171;
      }

      .text-answer {
        width: 100%;
        min-height: 200px;
        padding: 28px;
        border: 2px solid #f0f0f5;
        border-radius: 20px;
        font-size: 1.15em;
        font-family: inherit;
        resize: vertical;
        transition: all 0.3s ease;
        background: #fafbfc;
        margin-bottom: 30px;
        color: #334155;
        line-height: 1.6;
      }

      .text-answer:focus {
        outline: none;
        border-color: #7a6ad8;
        background: white;
        box-shadow: 0 0 0 4px rgba(122, 106, 216, 0.08);
      }

      .feedback {
        padding: 24px 32px;
        border-radius: 16px;
        margin-bottom: 40px;
        font-weight: 500;
        display: none;
        animation: slideDown 0.4s ease;
        font-size: 1.1em;
      }

      .feedback.show {
        display: block;
      }

      .feedback.correct {
        background: #f0fdf4;
        color: #166534;
        border: 2px solid #4ade80;
      }

      .feedback.incorrect {
        background: #fef2f2;
        color: #991b1b;
        border: 2px solid #f87171;
      }

      .feedback.info {
        background: #f8f7ff;
        color: #5b21b6;
        border: 2px solid #7a6ad8;
      }

      .feedback.loading {
        background: #fffbeb;
        color: #92400e;
        border: 2px solid #fbbf24;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .nav-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 50px;
      }

      .btn {
        background: linear-gradient(135deg, #7a6ad8, #9b8ce0);
        color: white;
        border: none;
        padding: 20px 50px;
        font-size: 1.1em;
        font-weight: 600;
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 6px 20px rgba(122, 106, 216, 0.3);
      }

      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(122, 106, 216, 0.4);
      }

      .btn:active:not(:disabled) {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
        color: #475569;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      .btn-secondary:hover:not(:disabled) {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
      }

      .result-screen {
        background: white;
        border-radius: 32px;
        padding: 100px 80px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        display: none;
        opacity: 0;
        transform: scale(0.95);
        transition: all 0.5s ease;
        border: 1px solid #f0f0f5;
      }

      .result-screen.show {
        display: block;
        opacity: 1;
        transform: scale(1);
      }

      .result-icon {
        font-size: 5em;
        margin-bottom: 30px;
        animation: bounce 1s ease;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .result-screen h2 {
        font-size: 3em;
        color: #1e293b;
        margin-bottom: 25px;
        font-weight: 700;
      }

      .score-display {
        font-size: 6em;
        font-weight: 800;
        background: linear-gradient(135deg, #7a6ad8, #9b8ce0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 30px 0;
      }

      .result-message {
        font-size: 1.4em;
        color: #64748b;
        margin-bottom: 50px;
        line-height: 1.8;
      }

      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top-color: #7a6ad8;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .question-slide {
          padding: 40px 30px;
        }

        .question-text {
          font-size: 1.5em;
        }

        .container {
          padding: 100px 20px 40px;
        }

        .result-screen {
          padding: 60px 30px;
        }

        .score-display {
          font-size: 4em;
        }

        .progress-container {
          padding: 20px;
        }

        .option {
          padding: 22px 26px;
          font-size: 1.05em;
        }

        .json-upload {
          padding: 40px 20px;
        }
      }
    </style>
  </head>
  <body>
    <div
      class="progress-container"
      id="progressContainer"
      style="display: none"
    >
      <div class="progress-wrapper">
        <div class="progress-text">
          <span class="progress-label">æµ‹éªŒè¿›åº¦</span>
          <span class="progress-count"
            ><span id="currentQuestion">1</span> /
            <span id="totalQuestions">0</span></span
          >
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressBar"></div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="json-upload" id="jsonUpload">
        <h2>ğŸ“ åœ¨çº¿æµ‹éªŒç³»ç»Ÿ</h2>
        <p style="color: #64748b; font-size: 1.2em; margin-bottom: 30px">
          æ­£åœ¨åŠ è½½æµ‹éªŒé¢˜ç›®...
        </p>
        <div
          id="loadingSpinner"
          style="
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #7a6ad8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          "
        ></div>
      </div>

      <div id="quizContainer"></div>

      <div class="result-screen" id="resultScreen">
        <div class="result-icon">ğŸ‰</div>
        <h2>æµ‹éªŒå®Œæˆï¼</h2>
        <div class="score-display" id="finalScore">0/0</div>
        <div class="result-message" id="resultMessage">
          æ­å–œä½ å®Œæˆäº†æ‰€æœ‰é¢˜ç›®ï¼<br />
          æ„Ÿè°¢ä½ çš„è®¤çœŸä½œç­”ã€‚
        </div>
        <button class="btn" onclick="location.reload()">é‡æ–°å¼€å§‹</button>
      </div>
    </div>

    <script>
      let questions = [];
      let currentIndex = 0;
      let score = 0;
      let answered = false;
      let userAnswers = [];
      let totalChoiceQuestions = 0;

      const API_URL = "https://api.siliconflow.cn/v1/chat/completions";
      const API_KEY = "sk-iujgwjycqgmvzxycfgyynuowipaykmbbcneerzvdnehpqvfs";

      // ç”Ÿæˆé¢˜ç›®çš„ prompt æ¨¡æ¿ï¼ˆæ¥è‡ª tools/quiz_prompts.pyï¼‰
      function generate_QUESTION_TEMPLATE(core_topic) {
        return `# è§’è‰²ä¸ä»»åŠ¡ ğŸ¯
ä½ æ˜¯ä¸€ä½èµ„æ·±çš„**æ•™è‚²è¯„ä¼°ä¸“å®¶**å’Œ**ä¸“ä¸šå‘½é¢˜äºº**ã€‚ä½ çš„ä»»åŠ¡æ˜¯æ ¹æ®ç»™å®šçš„æ ¸å¿ƒä¸»é¢˜ï¼Œç”Ÿæˆä¸€å¥—é«˜è´¨é‡ã€ä¸¥è°¨çš„æµ‹éªŒé¢˜ã€‚

# æ ¸å¿ƒä¸»é¢˜
æœ¬å¥—æµ‹éªŒçš„æ ¸å¿ƒä¸»é¢˜æ˜¯ï¼š**${core_topic}**

# è´¨é‡ä¸ä¸¥è°¨æ€§è¦æ±‚ ğŸ§
1.  **ä¸“ä¸šæ€§**ï¼šé¢˜ç›®å¿…é¡»åæ˜ è¯¥ä¸»é¢˜çš„æ ¸å¿ƒæ¦‚å¿µå’Œå…³é”®çŸ¥è¯†ç‚¹ã€‚
2.  **ä¸¥è°¨æ€§**ï¼šé—®é¢˜è¡¨è¿°æ¸…æ™°æ— æ­§ä¹‰ï¼Œç­”æ¡ˆå”¯ä¸€ä¸”æ­£ç¡®ã€‚
3.  **è¿·æƒ‘æ€§ï¼ˆé€‰æ‹©é¢˜ï¼‰**ï¼šé”™è¯¯é€‰é¡¹ (Distractors) å¿…é¡»å…·æœ‰é«˜åº¦çš„è¿·æƒ‘æ€§ï¼Œæ˜¯åŸºäºå¸¸è§è¯¯è§£è®¾è®¡çš„ï¼Œè€Œä¸èƒ½æ˜¯æ˜æ˜¾æ— å…³çš„é€‰é¡¹ã€‚

# æ•°é‡ä¸æ ¼å¼è¦æ±‚ (ã€å¼ºåˆ¶ã€‘)
è¯·**ä¸¥æ ¼ä¸”ä»…**è¾“å‡ºä¸€ä¸ªç¬¦åˆä»¥ä¸‹æ ¼å¼çš„ JSON å¯¹è±¡ã€‚**ç¦æ­¢**åœ¨ JSON å¯¹è±¡å‰åæ·»åŠ ä»»ä½•å¼€åœºç™½ã€è§£é‡Šã€æ€»ç»“æˆ– Markdown æ ‡è®° (å¦‚ \`\`\`json ... \`\`\`)ã€‚

**æ•°é‡**ï¼šå¿…é¡»åŒ…å« **8 ä¸ª** \`single-choice\` é¢˜ç›® å’Œ **2 ä¸ª** \`short-answer\` é¢˜ç›®ã€‚

!!!æ³¨æ„fillinblankæ˜¯ç®€ç­”é¢˜è€Œä¸æ˜¯å¡«ç©ºé¢˜ã€‚é€‰æ‹©é¢˜éœ€è¦ç»™å‡ºç­”æ¡ˆã€‚é€‰æ‹©é¢˜åŒ…å«ä¸‰ä¸ªå­—æ®µ[question,options,right-answer]ã€‚ä¸»è§‚é¢˜åŒ…å«ä¸€ä¸ªå­—æ®µ"question"

**JSON æ ¼å¼**ï¼š
{
  "title": "${core_topic}",
  "single-choice": [
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 1 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 2 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 3 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 4 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 5 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 6 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 7 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 8 ä¸ªé€‰æ‹©é¢˜é—®é¢˜ï¼‰",
      "options": ["A. é€‰é¡¹A", "B. é€‰é¡¹B", "C. é€‰é¡¹C", "D. é€‰é¡¹D"],
      "right-answer": "ï¼ˆA, B, C æˆ– Dï¼‰"
    }
  ],
  "short-answer": [
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 1 ä¸ªç®€ç­”é¢˜ï¼‰"
    },
    {
      "question": "ï¼ˆè¿™é‡Œæ˜¯ç¬¬ 2 ä¸ªç®€ç­”é¢˜ï¼‰"
    }
  ]
}
å†æ¬¡æç¤ºï¼š
1.ä¸»è§‚é¢˜ä¸æ˜¯å¡«ç©ºé¢˜ï¼Œåº”è¯¥æ˜¯ç­”é¢˜è€…ç”¨ä¸€æ®µè¯å›ç­”ã€‚
2. é€‰æ‹©é¢˜å¿…é¡»æŠŠç­”æ¡ˆä¸€èµ·è¾“å‡ºåœ¨jsonä¸­`;
      }

      // ä» URL å‚æ•°è·å–ä¸»é¢˜
      function getTopicFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("topic") || "å¤§æ•°æ®åˆ†æåŸºç¡€"; // é»˜è®¤ä¸»é¢˜
      }

      // è°ƒç”¨ LLM API ç”Ÿæˆé¢˜ç›®
      async function generateQuestions(topic) {
        const prompt = generate_QUESTION_TEMPLATE(topic);

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              Authorization: `Bearer ${API_KEY}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "inclusionAI/Ling-mini-2.0",
              messages: [
                {
                  role: "user",
                  content: prompt,
                },
              ],
            }),
          });

          if (!response.ok) {
            throw new Error(`API è¯·æ±‚å¤±è´¥: ${response.status}`);
          }

          const data = await response.json();
          const content = data.choices[0].message.content.trim();

          // å°è¯•è§£æ JSONï¼ˆå¤„ç†å¯èƒ½çš„ markdown æ ‡è®°ï¼‰
          let jsonContent = content;

          // ç§»é™¤å¯èƒ½çš„ markdown ä»£ç å—æ ‡è®°
          if (content.startsWith("```json")) {
            jsonContent = content
              .replace(/```json\s*/, "")
              .replace(/```\s*$/, "");
          } else if (content.startsWith("```")) {
            jsonContent = content.replace(/```\s*/, "").replace(/```\s*$/, "");
          }

          const questionsData = JSON.parse(jsonContent);
          return questionsData;
        } catch (error) {
          console.error("ç”Ÿæˆé¢˜ç›®å¤±è´¥:", error);
          throw error;
        }
      }

      // é¡µé¢åŠ è½½æ—¶è‡ªåŠ¨åŠ è½½é¢˜ç›®
      window.onload = function () {
        loadQuestions();
      };

      async function loadQuestions() {
        try {
          // è·å–ä¸»é¢˜
          const topic = getTopicFromURL();

          // æ›´æ–°åŠ è½½æç¤º
          document.querySelector(
            ".json-upload p"
          ).textContent = `æ­£åœ¨ä¸ºä¸»é¢˜"${topic}"ç”Ÿæˆæµ‹éªŒé¢˜ç›®...`;

          // è°ƒç”¨ API ç”Ÿæˆé¢˜ç›®
          const questionsData = await generateQuestions(topic);

          // å¤„ç†é¢˜ç›®
          processQuestions(questionsData);

          // å¼€å§‹æµ‹éªŒ
          startQuiz();
        } catch (error) {
          alert("é¢˜ç›®ç”Ÿæˆå¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•ï¼");
          console.error("é¢˜ç›®ç”Ÿæˆé”™è¯¯:", error);

          // æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
          document.querySelector(".json-upload p").textContent =
            "é¢˜ç›®ç”Ÿæˆå¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•";
          document.getElementById("loadingSpinner").style.display = "none";
        }
      }

      function processQuestions(jsonData) {
        questions = [];

        // å¤„ç†é€‰æ‹©é¢˜
        if (jsonData["single-choice"]) {
          jsonData["single-choice"].forEach((q) => {
            questions.push({
              type: "choice",
              question: q.question,
              options: q.options,
              answer: q["right-answer"],
            });
          });
          totalChoiceQuestions = jsonData["single-choice"].length;
        }

        // å¤„ç†ç®€ç­”é¢˜
        if (jsonData["short-answer"]) {
          jsonData["short-answer"].forEach((q) => {
            questions.push({
              type: "text",
              question: q.question,
              // ç®€ç­”é¢˜ç”± LLM è¯„åˆ†ï¼Œä¸éœ€è¦é¢„è®¾ç­”æ¡ˆ
            });
          });
        }

        document.getElementById("totalQuestions").textContent =
          questions.length;
      }

      function startQuiz() {
        document.getElementById("jsonUpload").style.display = "none";
        document.getElementById("progressContainer").style.display = "block";
        currentIndex = 0;
        score = 0;
        answered = false;
        userAnswers = [];
        renderQuestion();
      }

      function updateProgress() {
        const progress = ((currentIndex + 1) / questions.length) * 100;
        document.getElementById("progressBar").style.width = progress + "%";
        document.getElementById("currentQuestion").textContent =
          currentIndex + 1;
      }

      function renderQuestion() {
        const container = document.getElementById("quizContainer");
        const q = questions[currentIndex];
        answered = false;

        let html = `
                          <div class="question-slide active">
                              <div class="question-header">
                                  <span class="question-number">${
                                    q.type === "choice" ? "é€‰æ‹©é¢˜" : "ç®€ç­”é¢˜"
                                  } ${currentIndex + 1}</span>
                                  <span class="question-type">${
                                    q.type === "choice"
                                      ? "å•é¡¹é€‰æ‹©"
                                      : "å¼€æ”¾é—®ç­”"
                                  }</span>
                              </div>
                              <div class="question-text">${q.question}</div>
                      `;

        if (q.type === "choice") {
          html += '<div class="options">';
          q.options.forEach((option, index) => {
            const letter = String.fromCharCode(65 + index);
            html += `<div class="option" onclick="selectOption('${letter}')"><span>${option}</span><span class="option-icon"></span></div>`;
          });
          html += "</div>";
          html += '<div class="feedback" id="feedback"></div>';
        } else {
          html += `
                              <textarea class="text-answer" id="textAnswer" placeholder="è¯·åœ¨æ­¤è¾“å…¥ä½ çš„ç­”æ¡ˆ..."></textarea>
                              <div class="feedback" id="feedback"></div>
                          `;
        }

        html += `
                          <div class="nav-buttons">
                              ${
                                currentIndex > 0
                                  ? '<button class="btn btn-secondary" onclick="previousQuestion()">â† ä¸Šä¸€é¢˜</button>'
                                  : ""
                              }
                              <button class="btn" id="nextBtn" onclick="nextQuestion()" ${
                                q.type === "choice" ? "disabled" : ""
                              }>
                                  ${
                                    currentIndex === questions.length - 1
                                      ? "å®Œæˆæµ‹éªŒ â†’"
                                      : "ä¸‹ä¸€é¢˜ â†’"
                                  }
                              </button>
                          </div>
                      </div>
                      `;

        container.innerHTML = html;
        updateProgress();
      }

      function selectOption(selected) {
        if (answered) return;

        const q = questions[currentIndex];
        const options = document.querySelectorAll(".option");
        const feedback = document.getElementById("feedback");
        const nextBtn = document.getElementById("nextBtn");

        options.forEach((opt) => opt.classList.add("disabled"));

        const isCorrect = selected === q.answer;
        userAnswers[currentIndex] = { selected, correct: isCorrect };

        if (isCorrect) {
          score++;
          feedback.className = "feedback correct show";
          feedback.textContent = "âœ“ å¤ªæ£’äº†ï¼å›ç­”æ­£ç¡®ï¼";
        } else {
          feedback.className = "feedback incorrect show";
          feedback.textContent = `âœ— å›ç­”é”™è¯¯ã€‚æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${q.answer}`;
        }

        options.forEach((opt) => {
          const letter = opt.querySelector("span").textContent.charAt(0);
          const icon = opt.querySelector(".option-icon");
          if (letter === q.answer) {
            opt.classList.add("correct");
            icon.textContent = "âœ“";
          } else if (letter === selected) {
            opt.classList.add("incorrect");
            icon.textContent = "âœ—";
          }
        });

        answered = true;
        nextBtn.disabled = false;
      }

      async function evaluateTextAnswer(question, answer) {
        const prompt = `è¯·ä½ ä½œä¸ºä¸€ä¸ªè¯„åˆ†è€å¸ˆï¼Œè¯„åˆ¤ä»¥ä¸‹å­¦ç”Ÿçš„ç®€ç­”é¢˜ç­”æ¡ˆã€‚

é¢˜ç›®ï¼š${question}

å­¦ç”Ÿç­”æ¡ˆï¼š${answer}

è¯„åˆ†æ ‡å‡†ï¼š
1. ç­”æ¡ˆæ˜¯å¦ç†è§£å¹¶å›ç­”äº†é—®é¢˜çš„æ ¸å¿ƒå†…å®¹
2. ç­”æ¡ˆæ˜¯å¦æœ‰å®è´¨æ€§çš„å†…å®¹ï¼ˆä¸æ˜¯ç©ºæ´æˆ–æ•·è¡çš„å›ç­”ï¼‰
3. ç­”æ¡ˆçš„é€»è¾‘æ˜¯å¦æ¸…æ™°ã€è¡¨è¾¾æ˜¯å¦è¿è´¯
4. ç­”æ¡ˆæ˜¯å¦åŒ…å«äº†ç›¸å…³çš„çŸ¥è¯†ç‚¹

å¦‚æœç­”æ¡ˆæ»¡è¶³ä»¥ä¸Šå¤§éƒ¨åˆ†æ ‡å‡†ï¼Œæœ‰ä¸€å®šçš„è´¨é‡å’Œæ·±åº¦ï¼Œè¯·å›å¤"1|ä¼˜ç§€çš„å›ç­”ï¼ä½ çš„ç­”æ¡ˆæ¶µç›–äº†å…³é”®è¦ç‚¹ã€‚"
å¦‚æœç­”æ¡ˆåŸºæœ¬åˆç†ä½†ä¸å¤Ÿå®Œæ•´æˆ–æ·±å…¥ï¼Œè¯·å›å¤"1|å›ç­”æ­£ç¡®ï¼Œä½†è¿˜å¯ä»¥æ›´åŠ æ·±å…¥ã€‚"
å¦‚æœç­”æ¡ˆæ˜æ˜¾é”™è¯¯ã€ä¸ç›¸å…³ã€è¿‡äºç®€å•æˆ–ç©ºæ´ï¼Œè¯·å›å¤"0|å›ç­”éœ€è¦æ”¹è¿›ã€‚è¯·ç¡®ä¿ç†è§£é¢˜ç›®è¦æ±‚ï¼Œå¹¶æä¾›æ›´å…·ä½“çš„å†…å®¹ã€‚"

è¾“å‡ºæ ¼å¼ï¼š[åˆ†æ•°]|[åé¦ˆ]ï¼Œå…¶ä¸­åˆ†æ•°ä¸º0æˆ–1ã€‚`;

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              Authorization: `Bearer ${API_KEY}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "inclusionAI/Ling-mini-2.0",
              messages: [
                {
                  role: "user",
                  content: prompt,
                },
              ],
            }),
          });

          const data = await response.json();
          const result = data.choices[0].message.content.trim();

          // è§£æç»“æœ (æ ¼å¼: "åˆ†æ•°|åé¦ˆ")
          const parts = result.split("|");
          const scoreStr = parts[0].trim();
          const feedback = parts.length > 1 ? parts[1].trim() : "å·²è¯„åˆ†";

          const score = scoreStr.includes("1") ? 1 : 0;

          return { score, feedback };
        } catch (error) {
          console.error("LLMè¯„åˆ†é”™è¯¯:", error);
          // å¦‚æœAPIè°ƒç”¨å¤±è´¥ï¼Œç»™äºˆä¸­æ€§åé¦ˆ
          return { score: 1, feedback: "è¯„åˆ†ç³»ç»Ÿæš‚æ—¶ä¸å¯ç”¨ï¼Œå·²è‡ªåŠ¨ç»™åˆ†ã€‚" };
        }
      }

      async function nextQuestion() {
        const q = questions[currentIndex];

        if (q.type === "text") {
          const textAnswer = document.getElementById("textAnswer").value.trim();

          if (!textAnswer) {
            alert("è¯·è¾“å…¥ç­”æ¡ˆåå†ç»§ç»­ï¼");
            return;
          }

          // æ˜¾ç¤ºåŠ è½½æç¤º
          const feedback = document.getElementById("feedback");
          const nextBtn = document.getElementById("nextBtn");
          feedback.className = "feedback loading show";
          feedback.innerHTML =
            '<span class="loading-spinner"></span> æ­£åœ¨è¯„åˆ†ä¸­ï¼Œè¯·ç¨å€™...';
          nextBtn.disabled = true;

          // è°ƒç”¨LLMè¯„åˆ†
          const evalResult = await evaluateTextAnswer(q.question, textAnswer);

          userAnswers[currentIndex] = {
            answer: textAnswer,
            score: evalResult.score,
          };

          if (evalResult.score === 1) {
            score++;
            feedback.className = "feedback correct show";
            feedback.textContent = `âœ“ ${evalResult.feedback}`;
          } else {
            feedback.className = "feedback incorrect show";
            feedback.textContent = `âœ— ${evalResult.feedback}`;
          }

          // ç­‰å¾…2ç§’åç»§ç»­ï¼Œè®©ç”¨æˆ·çœ‹åˆ°åé¦ˆ
          await new Promise((resolve) => setTimeout(resolve, 2000));
          nextBtn.disabled = false;
        }

        if (currentIndex < questions.length - 1) {
          const slide = document.querySelector(".question-slide");
          slide.classList.remove("active");
          slide.classList.add("exit");

          setTimeout(() => {
            currentIndex++;
            renderQuestion();
          }, 400);
        } else {
          showResults();
        }
      }

      function previousQuestion() {
        if (currentIndex > 0) {
          const slide = document.querySelector(".question-slide");
          slide.classList.remove("active");
          slide.classList.add("exit");

          setTimeout(() => {
            currentIndex--;
            renderQuestion();
          }, 400);
        }
      }

      function showResults() {
        document.getElementById("quizContainer").style.display = "none";
        const resultScreen = document.getElementById("resultScreen");
        const finalScore = document.getElementById("finalScore");
        const resultMessage = document.getElementById("resultMessage");
        const resultIcon = document.querySelector(".result-icon");

        finalScore.textContent = `${score}/${questions.length}`;

        let message = "";
        let icon = "ğŸ‰";
        const percentage = (score / questions.length) * 100;

        if (percentage >= 90) {
          message = "ä¼˜ç§€ï¼ä½ çš„è¡¨ç°éå¸¸å‡ºè‰²ï¼";
          icon = "ğŸ†";
        } else if (percentage >= 70) {
          message = "è‰¯å¥½ï¼ç»§ç»­ä¿æŒï¼";
          icon = "â­";
        } else if (percentage >= 60) {
          message = "åŠæ ¼ï¼è¿˜æœ‰è¿›æ­¥ç©ºé—´ã€‚";
          icon = "ğŸ‘";
        } else {
          message = "ç»§ç»­åŠªåŠ›ï¼ä¸è¦æ°”é¦ã€‚";
          icon = "ğŸ’ª";
        }

        resultIcon.textContent = icon;
        resultMessage.innerHTML = `
                          æ€»å¾—åˆ†ï¼š${score}/${questions.length} åˆ†<br>
                          ${message}<br><br>
                          æ„Ÿè°¢ä½ å®Œæˆæ‰€æœ‰é¢˜ç›®ï¼
                      `;

        resultScreen.classList.add("show");
        document.getElementById("progressBar").style.width = "100%";
      }
    </script>
  </body>
</html>
