<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>在线测验</title>
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
          Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #fafbfc;
        color: #333;
      }

      .progress-container {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        background: white;
        padding: 24px 40px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        z-index: 100;
      }

      .progress-wrapper {
        max-width: 600px;
        margin: 0 auto;
      }

      .progress-text {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 16px;
      }

      .progress-label {
        color: #7a6ad8;
        font-weight: 600;
        font-size: 1.1em;
      }

      .progress-count {
        color: #64748b;
        font-size: 0.95em;
      }

      .progress-bar {
        background: #f1f0f9;
        height: 3px;
        border-radius: 10px;
        overflow: hidden;
        position: relative;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, #7a6ad8, #9b8ce0);
        width: 0%;
        transition: width 0.6s cubic-bezier(0.4, 0, 0.2, 1);
        border-radius: 10px;
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent
        );
        animation: shimmer 2s infinite;
      }

      @keyframes shimmer {
        0% {
          transform: translateX(-100%);
        }
        100% {
          transform: translateX(100%);
        }
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 120px 40px 60px;
      }

      .json-upload {
        background: white;
        border-radius: 32px;
        padding: 60px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        text-align: center;
        border: 1px solid #f0f0f5;
      }

      .json-upload h2 {
        font-size: 2.5em;
        color: #1e293b;
        margin-bottom: 30px;
      }

      .question-slide {
        background: white;
        border-radius: 32px;
        padding: 80px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        opacity: 0;
        transform: translateY(30px);
        transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        border: 1px solid #f0f0f5;
      }

      .question-slide.active {
        opacity: 1;
        transform: translateY(0);
      }

      .question-slide.exit {
        opacity: 0;
        transform: translateY(-30px);
      }

      .question-header {
        display: flex;
        align-items: center;
        gap: 16px;
        margin-bottom: 40px;
      }

      .question-number {
        background: linear-gradient(135deg, #7a6ad8, #9b8ce0);
        color: white;
        padding: 12px 28px;
        border-radius: 24px;
        font-weight: 600;
        font-size: 1em;
        box-shadow: 0 4px 12px rgba(122, 106, 216, 0.25);
      }

      .question-type {
        color: #94a3b8;
        font-size: 0.95em;
        font-weight: 500;
      }

      .question-text {
        font-size: 2em;
        font-weight: 600;
        color: #1e293b;
        margin-bottom: 50px;
        line-height: 1.5;
      }

      .options {
        display: grid;
        gap: 20px;
        margin-bottom: 40px;
      }

      .option {
        background: #fafbfc;
        border: 2px solid #f0f0f5;
        border-radius: 20px;
        padding: 28px 32px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        font-size: 1.2em;
        position: relative;
        color: #334155;
      }

      .option:hover:not(.disabled) {
        border-color: #7a6ad8;
        background: #f8f7ff;
        transform: translateX(8px);
        box-shadow: 0 4px 16px rgba(122, 106, 216, 0.15);
      }

      .option.selected {
        background: #f8f7ff;
        border-color: #7a6ad8;
      }

      .option.correct {
        background: #f0fdf4;
        border-color: #4ade80;
        animation: correctPulse 0.6s ease;
      }

      .option.incorrect {
        background: #fef2f2;
        border-color: #f87171;
        animation: incorrectShake 0.6s ease;
      }

      .option.disabled {
        cursor: not-allowed;
      }

      @keyframes correctPulse {
        0%,
        100% {
          transform: scale(1);
        }
        50% {
          transform: scale(1.02);
        }
      }

      @keyframes incorrectShake {
        0%,
        100% {
          transform: translateX(0);
        }
        25% {
          transform: translateX(-8px);
        }
        75% {
          transform: translateX(8px);
        }
      }

      .option-icon {
        position: absolute;
        right: 32px;
        top: 50%;
        transform: translateY(-50%);
        font-size: 1.5em;
        font-weight: bold;
      }

      .option.correct .option-icon {
        color: #4ade80;
      }

      .option.incorrect .option-icon {
        color: #f87171;
      }

      .text-answer {
        width: 100%;
        min-height: 200px;
        padding: 28px;
        border: 2px solid #f0f0f5;
        border-radius: 20px;
        font-size: 1.15em;
        font-family: inherit;
        resize: vertical;
        transition: all 0.3s ease;
        background: #fafbfc;
        margin-bottom: 30px;
        color: #334155;
        line-height: 1.6;
      }

      .text-answer:focus {
        outline: none;
        border-color: #7a6ad8;
        background: white;
        box-shadow: 0 0 0 4px rgba(122, 106, 216, 0.08);
      }

      .feedback {
        padding: 24px 32px;
        border-radius: 16px;
        margin-bottom: 40px;
        font-weight: 500;
        display: none;
        animation: slideDown 0.4s ease;
        font-size: 1.1em;
      }

      .feedback.show {
        display: block;
      }

      .feedback.correct {
        background: #f0fdf4;
        color: #166534;
        border: 2px solid #4ade80;
      }

      .feedback.incorrect {
        background: #fef2f2;
        color: #991b1b;
        border: 2px solid #f87171;
      }

      .feedback.info {
        background: #f8f7ff;
        color: #5b21b6;
        border: 2px solid #7a6ad8;
      }

      .feedback.loading {
        background: #fffbeb;
        color: #92400e;
        border: 2px solid #fbbf24;
      }

      @keyframes slideDown {
        from {
          opacity: 0;
          transform: translateY(-10px);
        }
        to {
          opacity: 1;
          transform: translateY(0);
        }
      }

      .nav-buttons {
        display: flex;
        gap: 20px;
        justify-content: center;
        margin-top: 50px;
      }

      .btn {
        background: linear-gradient(135deg, #7a6ad8, #9b8ce0);
        color: white;
        border: none;
        padding: 20px 50px;
        font-size: 1.1em;
        font-weight: 600;
        border-radius: 16px;
        cursor: pointer;
        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        box-shadow: 0 6px 20px rgba(122, 106, 216, 0.3);
      }

      .btn:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 30px rgba(122, 106, 216, 0.4);
      }

      .btn:active:not(:disabled) {
        transform: translateY(0);
      }

      .btn:disabled {
        opacity: 0.4;
        cursor: not-allowed;
        transform: none;
      }

      .btn-secondary {
        background: linear-gradient(135deg, #e2e8f0, #cbd5e1);
        color: #475569;
        box-shadow: 0 6px 20px rgba(0, 0, 0, 0.08);
      }

      .btn-secondary:hover:not(:disabled) {
        box-shadow: 0 10px 30px rgba(0, 0, 0, 0.12);
      }

      .result-screen {
        background: white;
        border-radius: 32px;
        padding: 100px 80px;
        text-align: center;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.06);
        display: none;
        opacity: 0;
        transform: scale(0.95);
        transition: all 0.5s ease;
        border: 1px solid #f0f0f5;
      }

      .result-screen.show {
        display: block;
        opacity: 1;
        transform: scale(1);
      }

      .result-icon {
        font-size: 5em;
        margin-bottom: 30px;
        animation: bounce 1s ease;
      }

      @keyframes bounce {
        0%,
        100% {
          transform: translateY(0);
        }
        50% {
          transform: translateY(-20px);
        }
      }

      .result-screen h2 {
        font-size: 3em;
        color: #1e293b;
        margin-bottom: 25px;
        font-weight: 700;
      }

      .score-display {
        font-size: 6em;
        font-weight: 800;
        background: linear-gradient(135deg, #7a6ad8, #9b8ce0);
        -webkit-background-clip: text;
        -webkit-text-fill-color: transparent;
        background-clip: text;
        margin: 30px 0;
      }

      .result-message {
        font-size: 1.4em;
        color: #64748b;
        margin-bottom: 50px;
        line-height: 1.8;
      }

      .loading-spinner {
        display: inline-block;
        width: 20px;
        height: 20px;
        border: 3px solid rgba(0, 0, 0, 0.1);
        border-radius: 50%;
        border-top-color: #7a6ad8;
        animation: spin 1s ease-in-out infinite;
      }

      @keyframes spin {
        to {
          transform: rotate(360deg);
        }
      }

      @media (max-width: 768px) {
        .question-slide {
          padding: 40px 30px;
        }

        .question-text {
          font-size: 1.5em;
        }

        .container {
          padding: 100px 20px 40px;
        }

        .result-screen {
          padding: 60px 30px;
        }

        .score-display {
          font-size: 4em;
        }

        .progress-container {
          padding: 20px;
        }

        .option {
          padding: 22px 26px;
          font-size: 1.05em;
        }

        .json-upload {
          padding: 40px 20px;
        }
      }
    </style>
  </head>
  <body>
    <div
      class="progress-container"
      id="progressContainer"
      style="display: none"
    >
      <div class="progress-wrapper">
        <div class="progress-text">
          <span class="progress-label">测验进度</span>
          <span class="progress-count"
            ><span id="currentQuestion">1</span> /
            <span id="totalQuestions">0</span></span
          >
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressBar"></div>
        </div>
      </div>
    </div>

    <div class="container">
      <div class="json-upload" id="jsonUpload">
        <h2>📝 在线测验系统</h2>
        <p style="color: #64748b; font-size: 1.2em; margin-bottom: 30px">
          正在加载测验题目...
        </p>
        <div
          id="loadingSpinner"
          style="
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid #f3f3f3;
            border-top: 4px solid #7a6ad8;
            border-radius: 50%;
            animation: spin 1s linear infinite;
          "
        ></div>
      </div>

      <div id="quizContainer"></div>

      <div class="result-screen" id="resultScreen">
        <div class="result-icon">🎉</div>
        <h2>测验完成！</h2>
        <div class="score-display" id="finalScore">0/0</div>
        <div class="result-message" id="resultMessage">
          恭喜你完成了所有题目！<br />
          感谢你的认真作答。
        </div>
        <button class="btn" onclick="location.reload()">重新开始</button>
      </div>
    </div>

    <script>
      let questions = [];
      let currentIndex = 0;
      let score = 0;
      let answered = false;
      let userAnswers = [];
      let totalChoiceQuestions = 0;

      const API_URL = "https://api.siliconflow.cn/v1/chat/completions";
      const API_KEY = "sk-iujgwjycqgmvzxycfgyynuowipaykmbbcneerzvdnehpqvfs";

      // 生成题目的 prompt 模板（来自 tools/quiz_prompts.py）
      function generate_QUESTION_TEMPLATE(core_topic) {
        return `# 角色与任务 🎯
你是一位资深的**教育评估专家**和**专业命题人**。你的任务是根据给定的核心主题，生成一套高质量、严谨的测验题。

# 核心主题
本套测验的核心主题是：**${core_topic}**

# 质量与严谨性要求 🧐
1.  **专业性**：题目必须反映该主题的核心概念和关键知识点。
2.  **严谨性**：问题表述清晰无歧义，答案唯一且正确。
3.  **迷惑性（选择题）**：错误选项 (Distractors) 必须具有高度的迷惑性，是基于常见误解设计的，而不能是明显无关的选项。

# 数量与格式要求 (【强制】)
请**严格且仅**输出一个符合以下格式的 JSON 对象。**禁止**在 JSON 对象前后添加任何开场白、解释、总结或 Markdown 标记 (如 \`\`\`json ... \`\`\`)。

**数量**：必须包含 **8 个** \`single-choice\` 题目 和 **2 个** \`short-answer\` 题目。

!!!注意fillinblank是简答题而不是填空题。选择题需要给出答案。选择题包含三个字段[question,options,right-answer]。主观题包含一个字段"question"

**JSON 格式**：
{
  "title": "${core_topic}",
  "single-choice": [
    {
      "question": "（这里是第 1 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    },
    {
      "question": "（这里是第 2 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    },
    {
      "question": "（这里是第 3 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    },
    {
      "question": "（这里是第 4 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    },
    {
      "question": "（这里是第 5 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    },
    {
      "question": "（这里是第 6 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    },
    {
      "question": "（这里是第 7 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    },
    {
      "question": "（这里是第 8 个选择题问题）",
      "options": ["A. 选项A", "B. 选项B", "C. 选项C", "D. 选项D"],
      "right-answer": "（A, B, C 或 D）"
    }
  ],
  "short-answer": [
    {
      "question": "（这里是第 1 个简答题）"
    },
    {
      "question": "（这里是第 2 个简答题）"
    }
  ]
}
再次提示：
1.主观题不是填空题，应该是答题者用一段话回答。
2. 选择题必须把答案一起输出在json中`;
      }

      // 从 URL 参数获取主题
      function getTopicFromURL() {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get("topic") || "大数据分析基础"; // 默认主题
      }

      // 调用 LLM API 生成题目
      async function generateQuestions(topic) {
        const prompt = generate_QUESTION_TEMPLATE(topic);

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              Authorization: `Bearer ${API_KEY}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "inclusionAI/Ling-mini-2.0",
              messages: [
                {
                  role: "user",
                  content: prompt,
                },
              ],
            }),
          });

          if (!response.ok) {
            throw new Error(`API 请求失败: ${response.status}`);
          }

          const data = await response.json();
          const content = data.choices[0].message.content.trim();

          // 尝试解析 JSON（处理可能的 markdown 标记）
          let jsonContent = content;

          // 移除可能的 markdown 代码块标记
          if (content.startsWith("```json")) {
            jsonContent = content
              .replace(/```json\s*/, "")
              .replace(/```\s*$/, "");
          } else if (content.startsWith("```")) {
            jsonContent = content.replace(/```\s*/, "").replace(/```\s*$/, "");
          }

          const questionsData = JSON.parse(jsonContent);
          return questionsData;
        } catch (error) {
          console.error("生成题目失败:", error);
          throw error;
        }
      }

      // 页面加载时自动加载题目
      window.onload = function () {
        loadQuestions();
      };

      async function loadQuestions() {
        try {
          // 获取主题
          const topic = getTopicFromURL();

          // 更新加载提示
          document.querySelector(
            ".json-upload p"
          ).textContent = `正在为主题"${topic}"生成测验题目...`;

          // 调用 API 生成题目
          const questionsData = await generateQuestions(topic);

          // 处理题目
          processQuestions(questionsData);

          // 开始测验
          startQuiz();
        } catch (error) {
          alert("题目生成失败，请刷新页面重试！");
          console.error("题目生成错误:", error);

          // 显示错误信息
          document.querySelector(".json-upload p").textContent =
            "题目生成失败，请刷新页面重试";
          document.getElementById("loadingSpinner").style.display = "none";
        }
      }

      function processQuestions(jsonData) {
        questions = [];

        // 处理选择题
        if (jsonData["single-choice"]) {
          jsonData["single-choice"].forEach((q) => {
            questions.push({
              type: "choice",
              question: q.question,
              options: q.options,
              answer: q["right-answer"],
            });
          });
          totalChoiceQuestions = jsonData["single-choice"].length;
        }

        // 处理简答题
        if (jsonData["short-answer"]) {
          jsonData["short-answer"].forEach((q) => {
            questions.push({
              type: "text",
              question: q.question,
              // 简答题由 LLM 评分，不需要预设答案
            });
          });
        }

        document.getElementById("totalQuestions").textContent =
          questions.length;
      }

      function startQuiz() {
        document.getElementById("jsonUpload").style.display = "none";
        document.getElementById("progressContainer").style.display = "block";
        currentIndex = 0;
        score = 0;
        answered = false;
        userAnswers = [];
        renderQuestion();
      }

      function updateProgress() {
        const progress = ((currentIndex + 1) / questions.length) * 100;
        document.getElementById("progressBar").style.width = progress + "%";
        document.getElementById("currentQuestion").textContent =
          currentIndex + 1;
      }

      function renderQuestion() {
        const container = document.getElementById("quizContainer");
        const q = questions[currentIndex];
        answered = false;

        let html = `
                          <div class="question-slide active">
                              <div class="question-header">
                                  <span class="question-number">${
                                    q.type === "choice" ? "选择题" : "简答题"
                                  } ${currentIndex + 1}</span>
                                  <span class="question-type">${
                                    q.type === "choice"
                                      ? "单项选择"
                                      : "开放问答"
                                  }</span>
                              </div>
                              <div class="question-text">${q.question}</div>
                      `;

        if (q.type === "choice") {
          html += '<div class="options">';
          q.options.forEach((option, index) => {
            const letter = String.fromCharCode(65 + index);
            html += `<div class="option" onclick="selectOption('${letter}')"><span>${option}</span><span class="option-icon"></span></div>`;
          });
          html += "</div>";
          html += '<div class="feedback" id="feedback"></div>';
        } else {
          html += `
                              <textarea class="text-answer" id="textAnswer" placeholder="请在此输入你的答案..."></textarea>
                              <div class="feedback" id="feedback"></div>
                          `;
        }

        html += `
                          <div class="nav-buttons">
                              ${
                                currentIndex > 0
                                  ? '<button class="btn btn-secondary" onclick="previousQuestion()">← 上一题</button>'
                                  : ""
                              }
                              <button class="btn" id="nextBtn" onclick="nextQuestion()" ${
                                q.type === "choice" ? "disabled" : ""
                              }>
                                  ${
                                    currentIndex === questions.length - 1
                                      ? "完成测验 →"
                                      : "下一题 →"
                                  }
                              </button>
                          </div>
                      </div>
                      `;

        container.innerHTML = html;
        updateProgress();
      }

      function selectOption(selected) {
        if (answered) return;

        const q = questions[currentIndex];
        const options = document.querySelectorAll(".option");
        const feedback = document.getElementById("feedback");
        const nextBtn = document.getElementById("nextBtn");

        options.forEach((opt) => opt.classList.add("disabled"));

        const isCorrect = selected === q.answer;
        userAnswers[currentIndex] = { selected, correct: isCorrect };

        if (isCorrect) {
          score++;
          feedback.className = "feedback correct show";
          feedback.textContent = "✓ 太棒了！回答正确！";
        } else {
          feedback.className = "feedback incorrect show";
          feedback.textContent = `✗ 回答错误。正确答案是：${q.answer}`;
        }

        options.forEach((opt) => {
          const letter = opt.querySelector("span").textContent.charAt(0);
          const icon = opt.querySelector(".option-icon");
          if (letter === q.answer) {
            opt.classList.add("correct");
            icon.textContent = "✓";
          } else if (letter === selected) {
            opt.classList.add("incorrect");
            icon.textContent = "✗";
          }
        });

        answered = true;
        nextBtn.disabled = false;
      }

      async function evaluateTextAnswer(question, answer) {
        const prompt = `请你作为一个评分老师，评判以下学生的简答题答案。

题目：${question}

学生答案：${answer}

评分标准：
1. 答案是否理解并回答了问题的核心内容
2. 答案是否有实质性的内容（不是空洞或敷衍的回答）
3. 答案的逻辑是否清晰、表达是否连贯
4. 答案是否包含了相关的知识点

如果答案满足以上大部分标准，有一定的质量和深度，请回复"1|优秀的回答！你的答案涵盖了关键要点。"
如果答案基本合理但不够完整或深入，请回复"1|回答正确，但还可以更加深入。"
如果答案明显错误、不相关、过于简单或空洞，请回复"0|回答需要改进。请确保理解题目要求，并提供更具体的内容。"

输出格式：[分数]|[反馈]，其中分数为0或1。`;

        try {
          const response = await fetch(API_URL, {
            method: "POST",
            headers: {
              Authorization: `Bearer ${API_KEY}`,
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              model: "inclusionAI/Ling-mini-2.0",
              messages: [
                {
                  role: "user",
                  content: prompt,
                },
              ],
            }),
          });

          const data = await response.json();
          const result = data.choices[0].message.content.trim();

          // 解析结果 (格式: "分数|反馈")
          const parts = result.split("|");
          const scoreStr = parts[0].trim();
          const feedback = parts.length > 1 ? parts[1].trim() : "已评分";

          const score = scoreStr.includes("1") ? 1 : 0;

          return { score, feedback };
        } catch (error) {
          console.error("LLM评分错误:", error);
          // 如果API调用失败，给予中性反馈
          return { score: 1, feedback: "评分系统暂时不可用，已自动给分。" };
        }
      }

      async function nextQuestion() {
        const q = questions[currentIndex];

        if (q.type === "text") {
          const textAnswer = document.getElementById("textAnswer").value.trim();

          if (!textAnswer) {
            alert("请输入答案后再继续！");
            return;
          }

          // 显示加载提示
          const feedback = document.getElementById("feedback");
          const nextBtn = document.getElementById("nextBtn");
          feedback.className = "feedback loading show";
          feedback.innerHTML =
            '<span class="loading-spinner"></span> 正在评分中，请稍候...';
          nextBtn.disabled = true;

          // 调用LLM评分
          const evalResult = await evaluateTextAnswer(q.question, textAnswer);

          userAnswers[currentIndex] = {
            answer: textAnswer,
            score: evalResult.score,
          };

          if (evalResult.score === 1) {
            score++;
            feedback.className = "feedback correct show";
            feedback.textContent = `✓ ${evalResult.feedback}`;
          } else {
            feedback.className = "feedback incorrect show";
            feedback.textContent = `✗ ${evalResult.feedback}`;
          }

          // 等待2秒后继续，让用户看到反馈
          await new Promise((resolve) => setTimeout(resolve, 2000));
          nextBtn.disabled = false;
        }

        if (currentIndex < questions.length - 1) {
          const slide = document.querySelector(".question-slide");
          slide.classList.remove("active");
          slide.classList.add("exit");

          setTimeout(() => {
            currentIndex++;
            renderQuestion();
          }, 400);
        } else {
          showResults();
        }
      }

      function previousQuestion() {
        if (currentIndex > 0) {
          const slide = document.querySelector(".question-slide");
          slide.classList.remove("active");
          slide.classList.add("exit");

          setTimeout(() => {
            currentIndex--;
            renderQuestion();
          }, 400);
        }
      }

      function showResults() {
        document.getElementById("quizContainer").style.display = "none";
        const resultScreen = document.getElementById("resultScreen");
        const finalScore = document.getElementById("finalScore");
        const resultMessage = document.getElementById("resultMessage");
        const resultIcon = document.querySelector(".result-icon");

        finalScore.textContent = `${score}/${questions.length}`;

        let message = "";
        let icon = "🎉";
        const percentage = (score / questions.length) * 100;

        if (percentage >= 90) {
          message = "优秀！你的表现非常出色！";
          icon = "🏆";
        } else if (percentage >= 70) {
          message = "良好！继续保持！";
          icon = "⭐";
        } else if (percentage >= 60) {
          message = "及格！还有进步空间。";
          icon = "👍";
        } else {
          message = "继续努力！不要气馁。";
          icon = "💪";
        }

        resultIcon.textContent = icon;
        resultMessage.innerHTML = `
                          总得分：${score}/${questions.length} 分<br>
                          ${message}<br><br>
                          感谢你完成所有题目！
                      `;

        resultScreen.classList.add("show");
        document.getElementById("progressBar").style.width = "100%";
      }
    </script>
  </body>
</html>
